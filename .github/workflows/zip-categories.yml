name: Auto Zip Meeting Folders

on:
  push:
    paths:
      - 'acm/**'
      - 'fbos/**'
      - 'rac/**'
      - 'frc/**'
      - 'herc/**'

jobs:
  zip:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write    # Required for GitHub Pages repos
      id-token: write # Required for GitHub Pages

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.PAT }}  # PAT with repo scope

      - name: Zip folders
        run: |
          for dir in acm fbos rac frc herc; do
            if [ -d "$dir" ]; then
              zip -r "${dir}/${dir}.zip" "$dir" -x "*.zip"
            fi
          done

      - name: Commit and push changes
        run: |
          # Configure git
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # Add all changes
          git add .
          
          # Commit and push if there are changes
          if ! git diff --cached --quiet; then
            git commit -m "Auto-zipped meeting folders on push"
            git remote set-url origin https://x-access-token:${{ secrets.PAT }}@github.com/bufoes/bufoes.github.io.git
            git push origin main
          fi
